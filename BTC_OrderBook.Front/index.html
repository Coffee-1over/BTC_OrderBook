</html><!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order Book Chart</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<style>
body{
display: grid;
place-items: center;
height: 100vh;
}
#container {
width: 1800px;
height: 700px;
margin: 0 auto;
padding:  100px;
}
</style>
</head>
<body>
<div id="container"></div>
<div >
  <button onclick="setCurrencyAndDraw('eur')">EUR</button>
  <button onclick="setCurrencyAndDraw('usd')">USD</button>
</div>
<script>

let toCurrecy = "eur";

 async function setCurrencyAndDraw(currecy){
toCurrecy = currecy;
await drawChart();
 }


async function getOrderBookData() {
  const response = await axios.get(`https://localhost:7172/api/orderbook/btc${toCurrecy.toLowerCase()}`);
  const orderBook = response.data.data;
  const asks = orderBook.asks.slice(0, orderBook.asks.length).map(a => [parseFloat(a[0]), parseFloat(a[1])]);
  const bids = orderBook.bids.slice(0, orderBook.bids.length).map(b => [parseFloat(b[0]), parseFloat(b[1])]);
  const minAsk = Math.min(...asks.map(a => a[0]));
  const maxBid = Math.max(...bids.map(b => b[0]));
    const range = maxBid - minAsk;
  return { asks, bids };
}

async function drawChart() {
  
  const { asks, bids } = await getOrderBookData();

  Highcharts.chart('container', {
    chart: {
    type: 'area',
    zoomType: 'xy'
  },
  title: {
    text: `${toCurrecy.toUpperCase()}-BTC Market Depth`
  },
  xAxis: {
    minPadding: 0,
    maxPadding: 0,
    max: 200000,
    title: {
      text: 'Price'
    }
  },
  yAxis: [{
    lineWidth: 1,
    gridLineWidth: 1,
    title: null,
    tickWidth: 1,
    tickLength: 5,
    tickPosition: 'inside',
    labels: {
      align: 'left',
      x: 8
    },
    max: 150
  }, {
    opposite: true,
    linkedTo: 0,
    lineWidth: 1,
    gridLineWidth: 0,
    title: null,
    tickWidth: 1,
    tickLength: 5,
    tickPosition: 'inside',
    labels: {
      align: 'right',
      x: -8
    }
  }],
  legend: {
    enabled: false
  },
  
  tooltip: {
    headerFormat: '<span style="font-size=10px;">Price: {point.key}</span><br/>',
    valueDecimals: 2
  },
    series: [{
      name: 'Asks',
      data: asks,
      color: '#fc5857'
    }, {
      name: 'Bids',
      data: bids,
      color: '#7CFC00'
    }]
  });
}
drawChart();
setInterval(drawChart, 5000);
</script>
</body>
</html>